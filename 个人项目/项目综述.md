# 项目综述与数据处理架构（江苏省25年省招）

## 项目目标
- 面向国家电网江苏省电力公司招采与中标公告资料，构建“从压缩包/Excel/PDF → 清洗标准化 → 筛选分类 → 洞察输出”的自动化流水线。
- 重点识别软件/数字化/检测类（PD/IR）项目，排除纯硬件与非软件类服务，形成可研判的数据资产与统计报表。

## 目录结构
- `archives_input/`：原始压缩包输入
- `xls_input/`：直接输入的 Excel（可选）
- `final_pulication_renamed/`：已统一命名的中标公告 PDF
- `final_pulication_tables/`：从 PDF 解析出的汇总表 CSV
- `outputs/`：管道所有产物聚合输出目录
  - `csv_output/`：Excel/Sheet 转换后的 CSV
  - `fused/`：按批次融合的聚合结果
  - `xls_extracted/`、`tmp_extract/`：压缩包展开与中间文件
  - 多份分析产物：`result.csv`、`opportunity_insights__*.csv`、`software_only__*.csv`、`pd_ir__*.csv`、`types_*.csv`、`archive_status.csv`
- 配置与脚本：`keywords.json`、`project_types.json`、`extract_archives.py`、`excel_to_csv.py`、`excel_filter.py`、`categorize_projects.py`、`analyze_insights.py`、`filter_pd_ir.py`、`extract_tables.py`、`normalize_tables.py`

## 数据处理流程
- 压缩包解压与目标 Excel 提取（`extract_archives.py`）
  - 递归展开多层 zip，保留命名包含“`一览表`/`需求`”的 Excel，输出至 `outputs/xls_extracted/<基准名>/`。
  - 失败与缺失场景通过 `check_extract_status.py` 生成 `outputs/archive_status.csv` 进行定位。
- Excel → CSV 清洗（`excel_to_csv.py`）
  - 统一清理“附件/Unnamed”干扰行与表头；按 Sheet 输出 `outputs/csv_output/<文件名>__<Sheet>.csv`。
- 六字段标准化抽取（`excel_filter.py`）
  - 统一词库 `keywords.json`，过滤纯硬件与非软件类；优先使用精确列“`招标项目标段名称`”，并对候选值进行短词剔除与打分。
  - 产出核心汇总 `outputs/result.csv`（六列：编号/单位/标段名称/金额/概况/范围）。
- 项目类型归类（`categorize_projects.py`）
  - 依据 `project_types.json` 将条目匹配到业务类别，输出类型汇总及“类型×单位”透视表。
- 洞察与标签（`analyze_insights.py`）
  - 基于 `keywords.json` 计算分类与 PD/IR 标签，输出多份机会洞察 CSV。
- 软件专项筛选（`filter_pd_ir.py`）
  - 提炼“软件相关”明细与汇总，保留 PD/IR 专项筛选结果。
- PDF 表格提取与归一化（`extract_tables.py`、`normalize_tables.py`）
  - 对 `final_pulication_renamed/` 中标公告 PDF 按页解析表格，合并为 `final_pulication_tables/<文件>_tables_merged.csv`。
  - 归一化列名、清除重复表头、规范“包号”“中标人”，并从“中标人”补全缺失包号与费用等细节。

## 核心脚本职责
- `extract_archives.py`：PowerShell 调用展开外层 zip，递归提取目标 Excel；命名基准以第一层内 zip 为主。
- `check_extract_status.py`：记录每个压缩包的展开/提取状态与目标 Excel 计数。
- `excel_to_csv.py`：Excel 读入与表头清洗，统一输出 CSV。
- `excel_filter.py`：列名柔性匹配与联合摘要，生成统一六字段结果。
- `categorize_projects.py`：按类型词典进行分类与单位维度汇总。
- `analyze_insights.py`：基于词库输出“按单位/类型/检测标签”的机会洞察。
- `filter_pd_ir.py`：软件相关筛选与 PD/IR 明细与汇总输出。
- `extract_tables.py`：Camelot/Fitz 解析 PDF 表格并合并导出。
- `normalize_tables.py`：规范列名与关键字段，修复缺失与混排问题。

## 关键词与类型词典
- `keywords.json`
  - `core/pd/ir/service/hardware/non_software/business_domains` 多维词集，供筛选与洞察共享。
- `project_types.json`
  - `{ "类型": [{ "name": "类型名", "keywords": ["词1", ...] }, ...] }`，覆盖信通、网络安全、营销、调度、新型电力系统、局放、无人机、电缆、设计咨询、传统运维等。

## 使用步骤（典型流水线）
- `python extract_archives.py`
- `python check_extract_status.py`
- `python excel_to_csv.py`
- `python excel_filter.py`
- `python categorize_projects.py`
- `python analyze_insights.py`
- `python filter_pd_ir.py`
- PDF场景：`python extract_tables.py` → `python normalize_tables.py`

## 依赖与运行环境
- 运行系统：Windows（使用 PowerShell `Expand-Archive`），Python 3.10+
- 主要依赖：`pandas`、`openpyxl`、`xlrd`、`camelot`、`fitz(PyMuPDF)`、`re`
- 建议使用 7-Zip 处理异常/非标准 zip 场景。

## 输出成果与价值
- 六字段统一汇总 `outputs/result.csv`，为后续分类与洞察提供稳定基座。
- 机会洞察与标签（单位/类型/PD-IR）多维报表，支持研判重点方向。
- 软件相关专项筛选，排除硬件/施工/检测服务，凸显数字化机会面。
- PDF中标表标准化，便于对接中标结果与形成合作图谱。

## 运维与优化建议
- 构建词库迭代机制：持续补充省侧术语与系统名（如 `PMS3.0`、`营销2.0`）。
- 融合中标结果：打通“业主-总包-软件商”关系图谱，服务渠道策略。
- 完善异常监控：对 `archive_status.csv`/`result_errors.csv` 建立提醒与重跑机制。

